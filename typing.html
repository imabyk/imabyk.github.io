<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Typing Practice App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 flex flex-col h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold">Typing Practice</h1>
        <nav>
            <select id="mode-selector" class="bg-blue-500 text-white p-2 rounded">
                <option value="typing">Typing Practice</option>
                <option value="quote">Random Quote</option>
                <option value="code">Code Typing</option>
            </select>
        </nav>
    </header>

    <!-- Main Content Container -->
    <div class="flex flex-grow">
        <!-- Left Ad Placeholder -->
        <div class="w-24 bg-gray-200 flex items-center justify-center">
            Left Ad
        </div>

        <!-- Main App Content -->
        <div class="flex-grow flex flex-col items-center justify-center p-4">
            <!-- Typing Area -->
            <div id="typing-container" class="w-full max-w-2xl bg-white p-6 rounded-lg shadow-md">
                <!-- Settings -->
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="flex flex-col">
                        <label for="duration-select" class="mb-1 text-sm font-medium text-gray-700">Test Duration</label>
                        <select id="duration-select" class="p-2 border rounded">
                            <option value="0">No time limit</option>
                            <option value="60">1 minute</option>
                            <option value="120">2 minutes</option>
                            <option value="180">3 minutes</option>
                            <option value="300">5 minutes</option>
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label for="character-limit-select" class="mb-1 text-sm font-medium text-gray-700">Character Limit</label>
                        <select id="character-limit-select" class="p-2 border rounded">
                            <option value="500">500 characters</option>
                            <option value="1000">1000 characters</option>
                            <option value="2000">2000 characters</option>
                            <option value="3000">3000 characters</option>
                            <option value="0">No limit</option>
                        </select>
                    </div>
                </div>

                <div id="text-display" class="mb-4 text-lg text-gray-700 h-40 overflow-auto border p-2"></div>
                
                <div class="flex items-center mb-4">
                    <button id="start-test" class="bg-green-500 text-white px-4 py-2 rounded mr-4">Start Test</button>
                    <div id="timer" class="text-xl font-bold">00:00</div>
                </div>

                <textarea 
                    id="typing-input" 
                    rows="6" 
                    class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Click 'Start Test' to begin typing..."
                    disabled
                ></textarea>

                <!-- Results Display -->
                <div id="results" class="mt-4 text-center">
                    <div id="accuracy" class="text-xl font-bold text-green-600"></div>
                    <div id="errors" class="text-xl text-red-600"></div>
                    <div id="character-count" class="text-xl text-blue-600"></div>
                    <div id="total-time" class="text-xl text-purple-600"></div>
                </div>
            </div>
        </div>

        <!-- Right Ad Placeholder -->
        <div class="w-24 bg-gray-200 flex items-center justify-center">
            Right Ad
        </div>
    </div>

    <!-- Top Ad Placeholder -->
    <div class="h-16 bg-gray-300 flex items-center justify-center">
        Top Ad Space
    </div>

    <script>
        class TypingApp {
            constructor() {
                this.textDisplay = document.getElementById('text-display');
                this.typingInput = document.getElementById('typing-input');
                this.accuracyDisplay = document.getElementById('accuracy');
                this.errorsDisplay = document.getElementById('errors');
                this.characterCountDisplay = document.getElementById('character-count');
                this.totalTimeDisplay = document.getElementById('total-time');
                this.modeSelector = document.getElementById('mode-selector');
                this.startTestButton = document.getElementById('start-test');
                this.timerDisplay = document.getElementById('timer');
                this.durationSelect = document.getElementById('duration-select');
                this.characterLimitSelect = document.getElementById('character-limit-select');

                this.currentText = '';
                this.startTime = null;
                this.timerInterval = null;
                this.testDuration = 0;
                this.characterLimit = 500;
                this.isTestActive = false;

                this.init();
            }

            async init() {
                this.bindEvents();
                await this.fetchRandomText();
            }

            bindEvents() {
                this.typingInput.addEventListener('input', () => this.trackTyping());
                this.modeSelector.addEventListener('change', () => this.changeMode());
                this.startTestButton.addEventListener('click', () => this.startTest());
                this.durationSelect.addEventListener('change', () => this.updateSettings());
                this.characterLimitSelect.addEventListener('change', () => this.updateSettings());
            }

            updateSettings() {
                this.testDuration = parseInt(this.durationSelect.value);
                this.characterLimit = parseInt(this.characterLimitSelect.value);
                
                // Fetch new text based on character limit if needed
                if (this.characterLimit > 0 && this.currentText.length !== this.characterLimit) {
                    this.fetchRandomText();
                }
            }

            async fetchRandomText() {
                try {
                    if (this.characterLimit === 0) {
                        const response = await axios.get('https://baconipsum.com/api/?type=meat-and-filler&sentences=10');
                        this.currentText = response.data[0];
                    } else {
                        // Fetch more text than needed and then slice
                        const sentences = Math.ceil(this.characterLimit / 50); // Rough estimate
                        const response = await axios.get(`https://baconipsum.com/api/?type=meat-and-filler&sentences=${sentences}`);
                        this.currentText = response.data[0].slice(0, this.characterLimit);
                    }
                    this.textDisplay.textContent = this.currentText;
                    this.resetTyping();
                } catch (error) {
                    this.textDisplay.textContent = 'Failed to fetch text. Please try again.';
                }
            }

            startTest() {
                this.typingInput.disabled = false;
                this.typingInput.focus();
                this.startTestButton.disabled = true;
                this.isTestActive = true;
                this.startTimer();
            }

            startTimer() {
                this.startTime = new Date();
                
                // Setup automatic end if there's a time limit
                if (this.testDuration > 0) {
                    setTimeout(() => {
                        if (this.isTestActive) {
                            this.completeTest();
                        }
                    }, this.testDuration * 1000);
                }
                
                this.timerInterval = setInterval(() => {
                    const currentTime = new Date();
                    const elapsedTime = new Date(currentTime - this.startTime);
                    const minutes = elapsedTime.getUTCMinutes().toString().padStart(2, '0');
                    const seconds = elapsedTime.getUTCSeconds().toString().padStart(2, '0');
                    this.timerDisplay.textContent = `${minutes}:${seconds}`;
                }, 1000);
            }

            resetTyping() {
                this.typingInput.value = '';
                this.typingInput.disabled = true;
                this.startTestButton.disabled = false;
                this.accuracyDisplay.textContent = '';
                this.errorsDisplay.textContent = '';
                this.characterCountDisplay.textContent = '';
                this.totalTimeDisplay.textContent = '';
                this.timerDisplay.textContent = '00:00';
                this.isTestActive = false;
                
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                this.startTime = null;
            }

            trackTyping() {
                if (!this.isTestActive) return;
                
                const inputText = this.typingInput.value;
                const accuracy = this.calculateAccuracy(inputText);
                const errors = this.countErrors(inputText);

                this.accuracyDisplay.textContent = `Accuracy: ${accuracy.toFixed(2)}%`;
                this.errorsDisplay.textContent = `Errors: ${errors}`;
                this.characterCountDisplay.textContent = `Characters: ${inputText.length}/${this.currentText.length}`;

                if (inputText.length >= this.currentText.length) {
                    this.completeTest();
                }
            }

            completeTest() {
                if (!this.isTestActive) return;
                
                this.isTestActive = false;
                clearInterval(this.timerInterval);
                const endTime = new Date();
                const totalTime = (endTime - this.startTime) / 1000;
                this.totalTimeDisplay.textContent = `Total Time: ${totalTime.toFixed(2)} seconds`;
                this.typingInput.disabled = true;
            }

            calculateAccuracy(inputText) {
                const correctChars = inputText.split('').filter((char, index) => 
                    char === this.currentText[index]
                ).length;
                
                // If no input yet, return 100
                if (inputText.length === 0) return 100;
                
                return (correctChars / Math.min(inputText.length, this.currentText.length)) * 100;
            }

            countErrors(inputText) {
                let errors = 0;
                const minLength = Math.min(inputText.length, this.currentText.length);
                
                for (let i = 0; i < minLength; i++) {
                    if (inputText[i] !== this.currentText[i]) {
                        errors++;
                    }
                }
                
                return errors;
            }

            changeMode() {
                const selectedMode = this.modeSelector.value;
                switch(selectedMode) {
                    case 'quote':
                        this.fetchRandomQuote();
                        break;
                    case 'code':
                        this.fetchRandomCode();
                        break;
                    default:
                        this.fetchRandomText();
                }
            }

            async fetchRandomQuote() {
                try {
                    const response = await axios.get('https://api.quotable.io/random');
                    this.currentText = response.data.content;
                    if (this.characterLimit > 0 && this.currentText.length > this.characterLimit) {
                        this.currentText = this.currentText.slice(0, this.characterLimit);
                    }
                    this.textDisplay.textContent = this.currentText;
                    this.resetTyping();
                } catch (error) {
                    this.textDisplay.textContent = 'Failed to fetch quote. Please try again.';
                }
            }

            async fetchRandomCode() {
                try {
                    const response = await axios.get('https://random-data-api.com/api/code/random_code');
                    this.currentText = response.data.snippet;
                    if (this.characterLimit > 0 && this.currentText.length > this.characterLimit) {
                        this.currentText = this.currentText.slice(0, this.characterLimit);
                    }
                    this.textDisplay.textContent = this.currentText;
                    this.resetTyping();
                } catch (error) {
                    this.textDisplay.textContent = 'Failed to fetch code snippet. Please try again.';
                }
            }
        }

        // Initialize the app
        new TypingApp();
    </script>
</body>
</html>
